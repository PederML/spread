<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commuter Model â€¢ spread</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Commuter Model">
<meta property="og:description" content="spread">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spread</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2020.9.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/commuter_model.html">Commuter Model Intro</a>
    </li>
    <li>
      <a href="../articles/including_vax.html">Commuter Model With Vax Data</a>
    </li>
    <li>
      <a href="../articles/asymmetric_mobility_intro.html">Asymmetric Mobility Intro</a>
    </li>
    <li>
      <a href="../articles/branching_process.html">Simple Branching Process Model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li>
  <a href="../news/">Changelog</a>
</li>
<li>
  <a href="../CONTRIBUTING.html">Contributing</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/folkehelseinstituttet/spread/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Commuter Model</h1>
                        <h4 class="author">Richard White</h4>
            
            <h4 class="date">2020-09-16</h4>
      
      
      <div class="hidden name"><code>commuter_model.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>This model is a stochastic SEIIaR (susceptible, exposed, infectious, infectious asymptomatic, recovered) metapopulation model. Each location has a local infection system, while the locations are connected by people who commute each day. The model differentiates between day and night. During the day you can infect/be infected in the location where you work, while during the night you can infect/be infected in the location where you live. It is the same commuters who travel back and forth each day. At the start of a day, all commuters are sent to their work location, where they mix for 12 hours. The commuters are then sent to their respective home locations, where they mix for 12 hours. The model is loosely based upon a published model by Engebretsen (2019).</p>
</div>
<div id="data-required" class="section level1">
<h1 class="hasAnchor">
<a href="#data-required" class="anchor"></a>Data required</h1>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://r-datatable.com">data.table</a></span>)
</pre></div>
<p><code>seiiar</code> is a dataset that contains the following variables for the entire population you want to model:</p>
<ul>
<li>
<code>location_code</code> a code for each location</li>
<li>
<code>S</code> the starting value of susceptible people</li>
<li>
<code>E</code> the starting value of exposed people</li>
<li>
<code>I</code> the starting value of infectious and symptomatic people</li>
<li>
<code>Ia</code> the starting value of infectious and asymptomatic people</li>
<li>
<code>R</code> the starting value of recovered people</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># no one in Norway is infected, and everyone is susceptible</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_noinfected_2017_b2020.html">norway_seiiar_noinfected_2017_b2020</a></span>
<span class="co">#&gt;      location_code      S E I Ia R</span>
<span class="co">#&gt;   1:   municip0301 666759 0 0  0 0</span>
<span class="co">#&gt;   2:   municip1101  14899 0 0  0 0</span>
<span class="co">#&gt;   3:   municip1103 140856 0 0  0 0</span>
<span class="co">#&gt;   4:   municip1106  37166 0 0  0 0</span>
<span class="co">#&gt;   5:   municip1108  76742 0 0  0 0</span>
<span class="co">#&gt;  ---                              </span>
<span class="co">#&gt; 352:   municip5440    991 0 0  0 0</span>
<span class="co">#&gt; 353:   municip5441   2911 0 0  0 0</span>
<span class="co">#&gt; 354:   municip5442    951 0 0  0 0</span>
<span class="co">#&gt; 355:   municip5443   2267 0 0  0 0</span>
<span class="co">#&gt; 356:   municip5444  10199 0 0  0 0</span>

<span class="co"># 10 people in Oslo are infected, and everyone is susceptible</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_oslo_2017_b2020.html">norway_seiiar_oslo_2017_b2020</a></span>
<span class="co">#&gt;      location_code      S E  I Ia R</span>
<span class="co">#&gt;   1:   municip0301 666749 0 10  0 0</span>
<span class="co">#&gt;   2:   municip1101  14899 0  0  0 0</span>
<span class="co">#&gt;   3:   municip1103 140856 0  0  0 0</span>
<span class="co">#&gt;   4:   municip1106  37166 0  0  0 0</span>
<span class="co">#&gt;   5:   municip1108  76742 0  0  0 0</span>
<span class="co">#&gt;  ---                               </span>
<span class="co">#&gt; 352:   municip5440    991 0  0  0 0</span>
<span class="co">#&gt; 353:   municip5441   2911 0  0  0 0</span>
<span class="co">#&gt; 354:   municip5442    951 0  0  0 0</span>
<span class="co">#&gt; 355:   municip5443   2267 0  0  0 0</span>
<span class="co">#&gt; 356:   municip5444  10199 0  0  0 0</span>

<span class="co"># no one in Norway is infected, and childhood vaccination data is used to</span>
<span class="co"># estimate the number of "recovered" (i.e. non-susceptible) people for measles</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_measles_noinfected_2017_b2020.html">norway_seiiar_measles_noinfected_2017_b2020</a></span>
<span class="co">#&gt;      location_code     S E I Ia      R</span>
<span class="co">#&gt;   1:   municip0301 59775 0 0  0 606984</span>
<span class="co">#&gt;   2:   municip1101  1027 0 0  0  13872</span>
<span class="co">#&gt;   3:   municip1103  8868 0 0  0 131988</span>
<span class="co">#&gt;   4:   municip1106  1557 0 0  0  35609</span>
<span class="co">#&gt;   5:   municip1108  3058 0 0  0  73684</span>
<span class="co">#&gt;  ---                                  </span>
<span class="co">#&gt; 352:   municip5440    56 0 0  0    935</span>
<span class="co">#&gt; 353:   municip5441   513 0 0  0   2398</span>
<span class="co">#&gt; 354:   municip5442    72 0 0  0    879</span>
<span class="co">#&gt; 355:   municip5443   150 0 0  0   2117</span>
<span class="co">#&gt; 356:   municip5444  1149 0 0  0   9050</span>

<span class="co"># 10 people in Oslo is infected, and childhood vaccination data is used to</span>
<span class="co"># estimate the number of "recovered" (i.e. non-susceptible) people for measles</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_measles_oslo_2017_b2020.html">norway_seiiar_measles_oslo_2017_b2020</a></span>
<span class="co">#&gt;      location_code     S E  I Ia      R</span>
<span class="co">#&gt;   1:   municip0301 59765 0 10  0 606984</span>
<span class="co">#&gt;   2:   municip1101  1027 0  0  0  13872</span>
<span class="co">#&gt;   3:   municip1103  8868 0  0  0 131988</span>
<span class="co">#&gt;   4:   municip1106  1557 0  0  0  35609</span>
<span class="co">#&gt;   5:   municip1108  3058 0  0  0  73684</span>
<span class="co">#&gt;  ---                                   </span>
<span class="co">#&gt; 352:   municip5440    56 0  0  0    935</span>
<span class="co">#&gt; 353:   municip5441   513 0  0  0   2398</span>
<span class="co">#&gt; 354:   municip5442    72 0  0  0    879</span>
<span class="co">#&gt; 355:   municip5443   150 0  0  0   2117</span>
<span class="co">#&gt; 356:   municip5444  1149 0  0  0   9050</span>

<span class="co"># we can take a closer look at Oslo</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_measles_oslo_2017_b2020.html">norway_seiiar_measles_oslo_2017_b2020</a></span>[<span class="kw">location_code</span><span class="op">==</span><span class="st">"municip0301"</span>]
<span class="co">#&gt;    location_code     S E  I Ia      R</span>
<span class="co">#&gt; 1:   municip0301 59765 0 10  0 606984</span>
</pre></div>
<p><code>commuters</code> is a dataset that contains the following variables:</p>
<ul>
<li>
<code>from</code> location code for the location where the people live</li>
<li>
<code>to</code> location code for the location where the people work</li>
<li>
<code>n</code> the number of people this applies to</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># we provide the number of municipal commuters in Norway in 2017</span>
<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_commuters_2017_b2020.html">norway_commuters_2017_b2020</a></span>
<span class="co">#&gt;               from          to    n</span>
<span class="co">#&gt;     1: municip0301 municip1101   71</span>
<span class="co">#&gt;     2: municip0301 municip1103 1423</span>
<span class="co">#&gt;     3: municip0301 municip1106  332</span>
<span class="co">#&gt;     4: municip0301 municip1108  652</span>
<span class="co">#&gt;     5: municip0301 municip1111    5</span>
<span class="co">#&gt;    ---                             </span>
<span class="co">#&gt; 23948: municip5444 municip5439    3</span>
<span class="co">#&gt; 23949: municip5444 municip5440    1</span>
<span class="co">#&gt; 23950: municip5444 municip5441   33</span>
<span class="co">#&gt; 23951: municip5444 municip5442   12</span>
<span class="co">#&gt; 23952: municip5444 municip5443    8</span>
</pre></div>
<p><code>r0</code> is the basic reproductive number.</p>
<p><code>latent_period</code> is the average number of days from when a person is exposed until they are infectious.</p>
<p><code>asymptomatic_prob</code> is the probability that an infectious person is asymptomatic.</p>
<p><code>asymptomatic_relative_infectiousness</code> is the relative infectiousness of an asymptomatic infectious person when compared to a symptomatic infectious person. This value is between 0 and 1.</p>
<p><code>days_simulation</code> the number of days you want to simulate.</p>
<p><code>N</code> this is the number of simulations that will be run and then the results will be averaged. This should generally be set to 1, unless you are performing model fitting.</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>We simulate one measles outbreak using the datasets <code><a href="../reference/norway_seiiar_measles_oslo_2017_b2020.html">spread::norway_seiiar_measles_oslo_2017_b2020</a></code> and <code><a href="../reference/norway_commuters_2017_b2020.html">spread::norway_commuters_2017_b2020</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">4</span>)
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="kw">spread</span>::<span class="fu"><a href="../reference/commuter.html">commuter</a></span>(
  seiiar=<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_seiiar_measles_oslo_2017_b2020.html">norway_seiiar_measles_oslo_2017_b2020</a></span>,
  commuters=<span class="kw">spread</span>::<span class="kw"><a href="../reference/norway_commuters_2017_b2020.html">norway_commuters_2017_b2020</a></span>,
  r0=<span class="fl">14</span>,
  latent_period = <span class="fl">8</span>,
  infectious_period = <span class="fl">5</span>,
  asymptomatic_prob=<span class="fl">0</span>,
  asymptomatic_relative_infectiousness=<span class="fl">0</span>,
  days_simulation=<span class="fl">7</span><span class="op">*</span><span class="fl">9</span>,
  N=<span class="fl">1</span>
)
<span class="co">#&gt; Starting to add edges, printing every 1000 edge</span>
<span class="co">#&gt; 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 21000 22000 23000 Found 23894 edges</span>
<span class="co">#&gt; Running 1 simulations of 63 days</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Finished all simulations</span>
</pre></div>
<p>Inspecting the data from Oslo:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">d</span>[<span class="kw">location_code</span><span class="op">==</span><span class="st">"municip0301"</span>]
<span class="co">#&gt;     sim_id location_code week day is_6pm     S  E I Ia      R incidence    pop</span>
<span class="co">#&gt;  1:      1   municip0301    1   1   TRUE 59764  2 9  0 606985         0 666760</span>
<span class="co">#&gt;  2:      1   municip0301    1   2   TRUE 59761  4 7  0 606988         1 666760</span>
<span class="co">#&gt;  3:      1   municip0301    1   3   TRUE 59760  4 5  0 606991         1 666760</span>
<span class="co">#&gt;  4:      1   municip0301    1   4   TRUE 59759  5 4  0 606992         0 666760</span>
<span class="co">#&gt;  5:      1   municip0301    1   5   TRUE 59759  5 2  0 606994         0 666760</span>
<span class="co">#&gt;  6:      1   municip0301    1   6   TRUE 59758  5 2  0 606995         1 666760</span>
<span class="co">#&gt;  7:      1   municip0301    1   7   TRUE 59756  7 2  0 606995         0 666760</span>
<span class="co">#&gt;  8:      1   municip0301    2   8   TRUE 59755  8 2  0 606995         0 666760</span>
<span class="co">#&gt;  9:      1   municip0301    2   9   TRUE 59755  6 4  0 606995         2 666760</span>
<span class="co">#&gt; 10:      1   municip0301    2  10   TRUE 59754  6 4  0 606996         1 666760</span>
<span class="co">#&gt; 11:      1   municip0301    2  11   TRUE 59754  6 3  0 606997         0 666760</span>
<span class="co">#&gt; 12:      1   municip0301    2  12   TRUE 59754  5 3  0 606998         1 666760</span>
<span class="co">#&gt; 13:      1   municip0301    2  13   TRUE 59752  7 3  0 606998         0 666760</span>
<span class="co">#&gt; 14:      1   municip0301    2  14   TRUE 59752  6 4  0 606998         1 666760</span>
<span class="co">#&gt; 15:      1   municip0301    3  15   TRUE 59752  4 6  0 606998         2 666760</span>
<span class="co">#&gt; 16:      1   municip0301    3  16   TRUE 59749  5 8  0 606998         2 666760</span>
<span class="co">#&gt; 17:      1   municip0301    3  17   TRUE 59746  8 7  0 606999         0 666760</span>
<span class="co">#&gt; 18:      1   municip0301    3  18   TRUE 59745  6 9  0 607000         3 666760</span>
<span class="co">#&gt; 19:      1   municip0301    3  19   TRUE 59743  6 9  0 607002         2 666760</span>
<span class="co">#&gt; 20:      1   municip0301    3  20   TRUE 59743  6 7  0 607004         0 666760</span>
<span class="co">#&gt; 21:      1   municip0301    3  21   TRUE 59743  4 5  0 607008         1 666760</span>
<span class="co">#&gt; 22:      1   municip0301    4  22   TRUE 59742  5 4  0 607009         0 666760</span>
<span class="co">#&gt; 23:      1   municip0301    4  23   TRUE 59741  6 3  0 607010         0 666760</span>
<span class="co">#&gt; 24:      1   municip0301    4  24   TRUE 59739  7 4  0 607010         1 666760</span>
<span class="co">#&gt; 25:      1   municip0301    4  25   TRUE 59739  7 3  0 607011         0 666760</span>
<span class="co">#&gt; 26:      1   municip0301    4  26   TRUE 59738  6 4  0 607012         2 666760</span>
<span class="co">#&gt; 27:      1   municip0301    4  27   TRUE 59738  4 5  0 607013         2 666760</span>
<span class="co">#&gt; 28:      1   municip0301    4  28   TRUE 59737  4 5  0 607014         1 666760</span>
<span class="co">#&gt; 29:      1   municip0301    5  29   TRUE 59736  5 5  0 607014         1 666760</span>
<span class="co">#&gt; 30:      1   municip0301    5  30   TRUE 59734  4 6  0 607016         3 666760</span>
<span class="co">#&gt; 31:      1   municip0301    5  31   TRUE 59732  5 7  0 607016         1 666760</span>
<span class="co">#&gt; 32:      1   municip0301    5  32   TRUE 59732  4 7  0 607017         1 666760</span>
<span class="co">#&gt; 33:      1   municip0301    5  33   TRUE 59732  4 6  0 607018         0 666760</span>
<span class="co">#&gt; 34:      1   municip0301    5  34   TRUE 59731  5 6  0 607018         0 666760</span>
<span class="co">#&gt; 35:      1   municip0301    5  35   TRUE 59731  5 5  0 607019         0 666760</span>
<span class="co">#&gt; 36:      1   municip0301    6  36   TRUE 59729  7 4  0 607020         0 666760</span>
<span class="co">#&gt; 37:      1   municip0301    6  37   TRUE 59729  5 5  0 607021         2 666760</span>
<span class="co">#&gt; 38:      1   municip0301    6  38   TRUE 59727  6 5  0 607022         1 666760</span>
<span class="co">#&gt; 39:      1   municip0301    6  39   TRUE 59727  5 5  0 607023         1 666760</span>
<span class="co">#&gt; 40:      1   municip0301    6  40   TRUE 59725  7 4  0 607024         0 666760</span>
<span class="co">#&gt; 41:      1   municip0301    6  41   TRUE 59725  7 3  0 607025         0 666760</span>
<span class="co">#&gt; 42:      1   municip0301    6  42   TRUE 59725  7 2  0 607026         0 666760</span>
<span class="co">#&gt; 43:      1   municip0301    7  43   TRUE 59724  7 3  0 607026         0 666760</span>
<span class="co">#&gt; 44:      1   municip0301    7  44   TRUE 59722  9 3  0 607026         0 666760</span>
<span class="co">#&gt; 45:      1   municip0301    7  45   TRUE 59721 10 3  0 607026         0 666760</span>
<span class="co">#&gt; 46:      1   municip0301    7  46   TRUE 59721  9 3  0 607027         1 666760</span>
<span class="co">#&gt; 47:      1   municip0301    7  47   TRUE 59720  9 4  0 607027         1 666760</span>
<span class="co">#&gt; 48:      1   municip0301    7  48   TRUE 59720  9 3  0 607028         0 666760</span>
<span class="co">#&gt; 49:      1   municip0301    7  49   TRUE 59718 10 4  0 607028         1 666760</span>
<span class="co">#&gt; 50:      1   municip0301    8  50   TRUE 59717 11 4  0 607028         0 666760</span>
<span class="co">#&gt; 51:      1   municip0301    8  51   TRUE 59717  9 6  0 607028         2 666760</span>
<span class="co">#&gt; 52:      1   municip0301    8  52   TRUE 59716 10 5  0 607029         0 666760</span>
<span class="co">#&gt; 53:      1   municip0301    8  53   TRUE 59716  9 5  0 607030         1 666760</span>
<span class="co">#&gt; 54:      1   municip0301    8  54   TRUE 59715  7 7  0 607031         2 666760</span>
<span class="co">#&gt; 55:      1   municip0301    8  55   TRUE 59714  8 6  0 607032         0 666760</span>
<span class="co">#&gt; 56:      1   municip0301    8  56   TRUE 59712  9 5  0 607034         1 666760</span>
<span class="co">#&gt; 57:      1   municip0301    9  57   TRUE 59711 10 3  0 607036         0 666760</span>
<span class="co">#&gt; 58:      1   municip0301    9  58   TRUE 59710 10 4  0 607036         1 666760</span>
<span class="co">#&gt; 59:      1   municip0301    9  59   TRUE 59707 13 4  0 607036         0 666760</span>
<span class="co">#&gt; 60:      1   municip0301    9  60   TRUE 59706 11 6  0 607037         4 666760</span>
<span class="co">#&gt; 61:      1   municip0301    9  61   TRUE 59705 12 6  0 607037         0 666760</span>
<span class="co">#&gt; 62:      1   municip0301    9  62   TRUE 59703 14 5  0 607038         0 666760</span>
<span class="co">#&gt; 63:      1   municip0301    9  63   TRUE 59701 13 7  0 607039         3 666760</span>
<span class="co">#&gt;     sim_id location_code week day is_6pm     S  E I Ia      R incidence    pop</span>
</pre></div>
<p>We can merge in information about counties, and create county level data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="kw">d</span>,<span class="kw">fhidata</span>::<span class="kw"><a href="https://rdrr.io/pkg/fhidata/man/norway_locations_b2020.html">norway_locations_b2020</a></span>, by.x=<span class="st">"location_code"</span>,by.y=<span class="st">"municip_code"</span>)
<span class="kw">county</span> <span class="op">&lt;-</span> <span class="kw">d</span>[,<span class="fu">.</span>(
  S=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">S</span>),
  E=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">E</span>),
  I=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">I</span>),
  Ia=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">Ia</span>),
  R=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">R</span>),
  incidence=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">incidence</span>),
  pop=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">pop</span>)
),
keyby=<span class="fu">.</span>(<span class="kw">county_code</span>,<span class="kw">county_name</span>,<span class="kw">week</span>,<span class="kw">day</span>,<span class="kw">is_6pm</span>)]
<span class="kw">county</span>[,<span class="kw">county_name</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw">county_name</span>,levels=<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span>(<span class="kw">fhidata</span>::<span class="kw"><a href="https://rdrr.io/pkg/fhidata/man/norway_locations_b2020.html">norway_locations_b2020</a></span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"county_code"</span>,<span class="st">"county_name"</span>)]<span class="op">$</span><span class="kw">county_name</span>))]
<span class="kw">county</span>
<span class="co">#&gt;      county_code       county_name week day is_6pm     S E I Ia      R</span>
<span class="co">#&gt;   1:    county03              Oslo    1   1   TRUE 59764 2 9  0 606985</span>
<span class="co">#&gt;   2:    county03              Oslo    1   2   TRUE 59761 4 7  0 606988</span>
<span class="co">#&gt;   3:    county03              Oslo    1   3   TRUE 59760 4 5  0 606991</span>
<span class="co">#&gt;   4:    county03              Oslo    1   4   TRUE 59759 5 4  0 606992</span>
<span class="co">#&gt;   5:    county03              Oslo    1   5   TRUE 59759 5 2  0 606994</span>
<span class="co">#&gt;  ---                                                                  </span>
<span class="co">#&gt; 689:    county54 Troms og Finnmark    9  59   TRUE 22632 0 0  0 220397</span>
<span class="co">#&gt; 690:    county54 Troms og Finnmark    9  60   TRUE 22632 0 0  0 220397</span>
<span class="co">#&gt; 691:    county54 Troms og Finnmark    9  61   TRUE 22632 0 0  0 220397</span>
<span class="co">#&gt; 692:    county54 Troms og Finnmark    9  62   TRUE 22632 0 0  0 220397</span>
<span class="co">#&gt; 693:    county54 Troms og Finnmark    9  63   TRUE 22632 0 0  0 220397</span>
<span class="co">#&gt;      incidence    pop</span>
<span class="co">#&gt;   1:         0 666760</span>
<span class="co">#&gt;   2:         1 666760</span>
<span class="co">#&gt;   3:         1 666760</span>
<span class="co">#&gt;   4:         0 666760</span>
<span class="co">#&gt;   5:         0 666760</span>
<span class="co">#&gt;  ---                 </span>
<span class="co">#&gt; 689:         0 243029</span>
<span class="co">#&gt; 690:         0 243029</span>
<span class="co">#&gt; 691:         0 243029</span>
<span class="co">#&gt; 692:         0 243029</span>
<span class="co">#&gt; 693:         0 243029</span>
</pre></div>
<p>We can produce a daily epicurve for each county:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">county</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x=<span class="kw">day</span>, y=<span class="kw">incidence</span>))
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>()
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">county_name</span>)
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"Day"</span>)
<span class="kw">p</span>
</pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>And we can produce weekly maps:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">w</span> <span class="op">&lt;-</span> <span class="kw">county</span>[,<span class="fu">.</span>(
  incidence_weekly = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">incidence</span>),
  pop = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">pop</span>)
), keyby=<span class="fu">.</span>(<span class="kw">county_code</span>, <span class="kw">week</span>)]

<span class="kw">w</span>[,<span class="kw">weekly_incidence_per_10000</span> <span class="op">:=</span> <span class="fl">10000</span><span class="op">*</span><span class="kw">incidence_weekly</span><span class="op">/</span><span class="kw">pop</span>]
<span class="kw">w</span>[,<span class="kw">facet</span><span class="op">:=</span><span class="kw">glue</span>::<span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="st">"Week {week}"</span>,week=<span class="kw">week</span>)]

<span class="kw">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(
  <span class="kw">w</span>,
  <span class="kw">fhidata</span>::<span class="kw"><a href="https://rdrr.io/pkg/fhidata/man/norway_map_counties_b2020.html">norway_map_counties_b2020</a></span>, 
  by.x=<span class="st">"county_code"</span>,
  by.y=<span class="st">"location_code"</span>,
  allow.cartesian = <span class="kw">T</span>)

<span class="kw">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(data=<span class="kw">pd</span>, mapping=<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>( x = <span class="kw">long</span>, y = <span class="kw">lat</span>, group = <span class="kw">group</span>))
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(fill=<span class="kw">weekly_incidence_per_10000</span>))
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">facet</span>)
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="kw">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">coord_quickmap</a></span>()
<span class="kw">p</span>
</pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Solveig Engebretsen, Andreas NygÃ¥rd Osnes, Gunnar RÃ¸ Osnes, Richard White.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
